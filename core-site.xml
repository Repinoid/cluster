<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
<configuration>
  <!-- Основные настройки MinIO/S3 -->
  <property>
    <name>fs.s3a.endpoint</name>
    <value>http://minio:9000</value>
  </property>
  <property>
    <name>fs.s3a.access.key</name>
    <value>minio</value>
  </property>
  <property>
    <name>fs.s3a.secret.key</name>
    <value>mpassword</value>
  </property>
  <property>
    <name>fs.s3a.path.style.access</name>
    <value>true</value>
  </property>
  <property>
    <name>fs.s3a.connection.ssl.enabled</name>
    <value>false</value>
  </property>
  <property>
    <name>fs.s3a.impl</name>
    <value>org.apache.hadoop.fs.s3a.S3AFileSystem</value>
  </property>
  
  <!-- КРИТИЧЕСКИ ВАЖНО: Исправленный credentials provider -->
  <property>
    <name>fs.s3a.aws.credentials.provider</name>
    <value>org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider</value>
    <description>
      Используем SimpleAWSCredentialsProvider вместо IAMInstanceCredentialsProvider
      который отсутствует в текущей версии и вызывает ClassNotFoundException
    </description>
  </property>

  <!-- Дополнительные настройки для стабильности -->
  <property>
    <name>fs.s3a.connection.timeout</name>
    <value>10000</value>
    <description>Таймаут подключения к S3 (мс)</description>
  </property>
  <property>
    <name>fs.s3a.connection.maximum</name>
    <value>15</value>
    <description>Максимальное количество соединений</description>
  </property>
  <property>
    <name>fs.s3a.threads.max</name>
    <value>10</value>
    <description>Максимальное количество потоков</description>
  </property>

  <!-- Настройки Hive Metastore -->
  <property>
    <name>hive.security.metastore.authorization.manager</name>
    <value>org.apache.hadoop.hive.ql.security.authorization.DefaultHiveMetastoreAuthorizationProvider</value>
    <description>
      authorization manager class name to be used in the metastore for authorization.
      The user defined authorization class should implement interface
      org.apache.hadoop.hive.ql.security.authorization.HiveMetastoreAuthorizationProvider.
    </description>
  </property>

  <property>
    <name>hive.security.metastore.authenticator.manager</name>
    <value>org.apache.hadoop.hive.ql.security.HadoopDefaultMetastoreAuthenticator</value>
    <description>
      authenticator manager class name to be used in the metastore for authentication.
      The user defined authenticator should implement interface 
      org.apache.hadoop.hive.ql.security.HiveAuthenticationProvider.
    </description>
  </property>

  <property>
    <name>hive.metastore.pre.event.listeners</name>
    <value></value>
    <description>
      pre-event listener classes to be loaded on the metastore side to run code
      whenever databases, tables, and partitions are created, altered, or dropped.
      Set to org.apache.hadoop.hive.ql.security.authorization.AuthorizationPreEventListener
      if metastore-side authorization is desired.
    </description>
  </property>

  <!-- Отладочное логирование -->
  <property>
    <name>fs.s3a.log.level</name>
    <value>DEBUG</value>
    <description>Уровень логирования для отладки S3A подключения</description>
  </property>

  <!-- Настройки для работы с Hadoop 3.3.6 -->
  <property>
    <name>fs.s3a.committer.name</name>
    <value>directory</value>
    <description>Тип коммитера для записи в S3</description>
  </property>
  
  <property>
    <name>fs.s3a.buffer.dir</name>
    <value>/tmp</value>
    <description>Директория для буферизации данных</description>
  </property>

</configuration>
