# TPCH

## бенчмарк (тестовый стандарт) для систем обработки данных (СУБД, Big Data системы и т.д.). 
- Его название расшифровывается как `Transaction Processing Performance Council - ad-Hoc query benchmark`.

### Его ключевые особенности:

- `Схема данных:` Моделирует среду принятия решений для бизнеса. Включает в себя 8 связанных таблиц (например, orders, lineitem, customer, part, supplier и др.), которые образуют "снежинку".

- `Набор запросов:` Содержит 22 сложных аналитических запроса (ad-hoc), которые выполняют сканирование больших объемов данных, используют агрегации, соединения множества таблиц и сложные предикаты.

- `Масштабируемость:` Данные могут быть сгенерированы для разных масштабов (Scale Factor - SF). Например, SF=1 — это ~1 ГБ сырых данных, SF=100 — ~100 ГБ и т.д.

###  Для чего нужен коннектор tpch в Trino?
- Коннектор tpch НЕ подключается к реальной базе данных. `Это генератор синтетических данных на лету.`

## Его основное предназначение:

### 1. Тестирование и Демонстрация
- `Быстрый старт:` Позволяет установить Trino и сразу начать писать SQL-запросы, не настраивая доступ к реальным источникам данных. Не нужно создавать таблицы, загружать данные — всё уже готово.

- `Демонстрация возможностей:` Идеально подходит для демонстрации мощности Trino: как он выполняет сложные JOIN'ы, агрегации и аналитические функции. Запросы из TPC-H отлично для этого подходят.

- `Обучение:` Отличный инструмент для изучения синтаксиса SQL и особенностей работы Trino.

### 2. Бенчмаркинг и Настройка Производительности
- `Сравнение конфигураций:` Если вы меняете настройки Trino (например, объем памяти, логику планировщика), вы можете запускать одни и те же запросы TPC-H на коннекторе до и после изменения, чтобы замерить разницу в производительности.

- `Тестирование кластера:` Позволяет проверить, корректно ли работает весь кластер Trino под нагрузкой, не создавая реальную нагрузку на продакшен-базы данных.

### 3. Разработка и Отладка
- Разработчики ядра Trino и коннекторов используют TPCH для отладки и проверки правильности работы оптимизатора запросов, планировщика и исполнительных механизмов.

### Как это работает на практике?
- Вы настраиваете в Trino каталог (catalog), который использует этот коннектор. Обычно это делается в файле `etc/catalog/tpch.properties`:
```
connector.name=tpch
tpch.splits-per-node=4
```
Имя каталога (здесь `tpch`) станет названием схемы в Trino.

- В клиенте Trino вы можете выполнить запрос  sql:  <br>
*Показывает доступные схемы в каталоге tpch*
```
SHOW SCHEMAS FROM tpch;
```
*Показывает таблицы в схеме sf1 (масштаб 1)*
```
SHOW TABLES FROM tpch.sf1;
```
*Выполняет один из запросов бенчмарка*
```
SELECT
  n.name,
  SUM(l.extendedprice * (1 - l.discount)) AS revenue
FROM
  tpch.sf1.customer c,
  tpch.sf1.orders o,
  tpch.sf1.lineitem l,
  tpch.sf1.supplier s,
  tpch.sf1.nation n,
  tpch.sf1.region r
WHERE
  c.custkey = o.custkey
  AND l.orderkey = o.orderkey
  AND l.suppkey = s.suppkey
  AND c.nationkey = s.nationkey
  AND s.nationkey = n.nationkey
  AND n.regionkey = r.regionkey
  AND r.name = 'ASIA'
  AND o.orderdate >= DATE '1994-01-01'
  AND o.orderdate < DATE '1994-01-01' + INTERVAL '1' YEAR
GROUP BY
  n.name
ORDER BY
  revenue DESC;
```

***Важно:*** При каждом выполнении запроса данные генерируются в оперативной памяти динамически, в соответствии с выбранным масштабом (sf1, sf100, sf1000 и т.д.). Никакие данные на диск не сохраняются.

## Итог
Параметр **connector.name=tpch** указывает на использование встроенного коннектора-генератора, который эмулирует базу данных TPC-H. Это чрезвычайно полезный инструмент для тестирования, демонстрации, обучения и бенчмаркинга Trino, но он не предназначен для работы с реальными пользовательскими данными.